
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../infra/snowflake/">
      
      
        <link rel="next" href="../repo-setup/">
      
      
      <link rel="icon" href="../../images/odi-circle_logomark-blue.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Snowflake setup - CalData Data Services and Engineering Infrastructure</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#new-project-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="CalData Data Services and Engineering Infrastructure" class="md-header__button md-logo" aria-label="CalData Data Services and Engineering Infrastructure" data-md-component="logo">
      
  <img src="../../images/odi-square_logomark-blue.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CalData Data Services and Engineering Infrastructure
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Snowflake setup
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/cagov/data-infrastructure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cagov/data-infrastructure
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="CalData Data Services and Engineering Infrastructure" class="md-nav__button md-logo" aria-label="CalData Data Services and Engineering Infrastructure" data-md-component="logo">
      
  <img src="../../images/odi-square_logomark-blue.svg" alt="logo">

    </a>
    CalData Data Services and Engineering Infrastructure
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cagov/data-infrastructure" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cagov/data-infrastructure
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Code development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Code development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/local-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Local environment setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/codespaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Codespaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/code-review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Review
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/writing-documentation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Writing Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/terraform-local-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terraform Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/github-project-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Project Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/azdevops-project-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure DevOps Project Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../code/working-with-snowflake-objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Working with Snowflake notebooks and Streamlit
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project infrastructure
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Project infrastructure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infra/cloud-infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud infrastructure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infra/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infra/snowflake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Snowflake overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Project setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Snowflake setup
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Snowflake setup
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtain-permissions-in-snowflake" class="md-nav__link">
    <span class="md-ellipsis">
      Obtain permissions in Snowflake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-access-to-aws" class="md-nav__link">
    <span class="md-ellipsis">
      Get access to AWS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-terraform-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Install terraform dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snowflake-account-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Snowflake account setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snowflake account setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-account" class="md-nav__link">
    <span class="md-ellipsis">
      Create the account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-multi-factor-authentication-for-your-user" class="md-nav__link">
    <span class="md-ellipsis">
      Enable multi-factor authentication for your user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-key-pair-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Set up key pair authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-a-session-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Apply a session policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-against-production-data" class="md-nav__link">
    <span class="md-ellipsis">
      Developing against production data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streamlit-dashboard-development" class="md-nav__link">
    <span class="md-ellipsis">
      Streamlit dashboard development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-it-ops-representatives" class="md-nav__link">
    <span class="md-ellipsis">
      Add IT-Ops representatives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-okta-sso-and-scim" class="md-nav__link">
    <span class="md-ellipsis">
      Set up Okta SSO and SCIM
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repo-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    git/Github setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-project-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Terraform setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sentinel-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sentinel setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dbt-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dbt Cloud setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fivetran-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fivetran setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snowflake-service-accounts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding service accounts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project-teardown/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Project teardown
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    dbt
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            dbt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dbt/dbt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dbt overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dbt/dbt-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dbt performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../dbt_docs_snowflake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dbt Cloud Snowflake project
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/footprints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building footprints
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Learning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Learning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MDSA glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Security guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/naming-conventions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Naming conventions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    git
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/dbt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dbt
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learning/cloud-data-warehouses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cloud data warehouses
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#obtain-permissions-in-snowflake" class="md-nav__link">
    <span class="md-ellipsis">
      Obtain permissions in Snowflake
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-access-to-aws" class="md-nav__link">
    <span class="md-ellipsis">
      Get access to AWS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-terraform-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Install terraform dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snowflake-account-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Snowflake account setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snowflake account setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-account" class="md-nav__link">
    <span class="md-ellipsis">
      Create the account
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-multi-factor-authentication-for-your-user" class="md-nav__link">
    <span class="md-ellipsis">
      Enable multi-factor authentication for your user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-key-pair-authentication" class="md-nav__link">
    <span class="md-ellipsis">
      Set up key pair authentication
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apply-a-session-policy" class="md-nav__link">
    <span class="md-ellipsis">
      Apply a session policy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#developing-against-production-data" class="md-nav__link">
    <span class="md-ellipsis">
      Developing against production data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streamlit-dashboard-development" class="md-nav__link">
    <span class="md-ellipsis">
      Streamlit dashboard development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-it-ops-representatives" class="md-nav__link">
    <span class="md-ellipsis">
      Add IT-Ops representatives
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-up-okta-sso-and-scim" class="md-nav__link">
    <span class="md-ellipsis">
      Set up Okta SSO and SCIM
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="new-project-setup">New project setup<a class="headerlink" href="#new-project-setup" title="Permanent link">&para;</a></h1>
<p>The DSE team regularly creates new Snowflake accounts in our Snowflake org.
We do this instead of putting all of our data projects into our main account for a few reasons:</p>
<ol>
<li>At the end of a project, we often want to transfer account ownership to our partners.
    Having it separated from the start helps that process.</li>
<li>We frequently want to add our project champion or IT partners to our account as admins.
    This is safer if project accounts are separate.</li>
<li>We often want to have accounts in a specific cloud and region for compliance or data transfer regions.</li>
<li>Different projects may require different approaches to account-level operations like OAuth/SAML.</li>
</ol>
<p>Here we document the steps to creating a new Snowflake account from scratch.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<h3 id="obtain-permissions-in-snowflake">Obtain permissions in Snowflake<a class="headerlink" href="#obtain-permissions-in-snowflake" title="Permanent link">&para;</a></h3>
<p>In order to create a new account, you will need access to the <code>orgadmin</code> role.
If you have <code>accountadmin</code> in the primary Snowflake account, you can grant it to yourself:</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">accountadmin</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">orgadmin</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="o">&lt;</span><span class="n">YOUR</span><span class="o">-</span><span class="k">USER</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<p>If you later want to revoke the <code>orgadmin</code> role from your user or any other, you can do so with:</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">accountadmin</span><span class="p">;</span>
<span class="k">REVOKE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">orgadmin</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="o">&lt;</span><span class="n">YOUR</span><span class="o">-</span><span class="k">USER</span><span class="o">&gt;</span><span class="p">;</span>
</code></pre></div>
<h3 id="get-access-to-aws">Get access to AWS<a class="headerlink" href="#get-access-to-aws" title="Permanent link">&para;</a></h3>
<p>We typically create our Snowflake architecture using Terraform.
Terraform state is stored in S3 buckets within our AWS account,
so you will need read/write access to those buckets.</p>
<p>Ask a DSE AWS admin to give you access to these buckets,
and <a href="../../code/local-setup/#aws">configure your AWS credentials</a>.</p>
<h3 id="install-terraform-dependencies">Install terraform dependencies<a class="headerlink" href="#install-terraform-dependencies" title="Permanent link">&para;</a></h3>
<p>You can install Terraform using whatever approach makes sense for your system,
including using <code>brew</code> or <code>conda</code>.</p>
<p>Here is a sample for installing the dependencies using <code>conda</code>:</p>
<div class="highlight"><pre><span></span><code>conda<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>infra<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10<span class="w">  </span><span class="c1"># create an environment named &#39;infra&#39;</span>
conda<span class="w"> </span>activate<span class="w"> </span>infra<span class="w">  </span><span class="c1"># activate the environment</span>
conda<span class="w"> </span>install<span class="w"> </span>-c<span class="w"> </span>conda-forge<span class="w"> </span>terraform<span class="w"> </span>tflint<span class="w">  </span><span class="c1"># Install terraform and tflint</span>
</code></pre></div>
<h2 id="snowflake-account-setup">Snowflake account setup<a class="headerlink" href="#snowflake-account-setup" title="Permanent link">&para;</a></h2>
<h3 id="create-the-account">Create the account<a class="headerlink" href="#create-the-account" title="Permanent link">&para;</a></h3>
<ol>
<li>Assume the <code>ORGADMIN</code> role</li>
<li>Under the "Admin" side panel, go to "Accounts" and click the "+ Account" button:<ol>
<li>Select the cloud and region appropriate to the project. The region should be in the United States.</li>
<li>Select "Business Critical" for the Snowflake Edition.</li>
<li>You will be prompted to create an initial user with <code>ACCOUNTADMIN</code> privileges. This should be you.
    You will be prompted to create a password for your user. Create one using your password manager,
    but know that it will ask you to change your password upon first log-in.</li>
<li>Save the Account Locator, Organization name, Account name and Account URL for your new account.</li>
</ol>
</li>
<li>Log into your new account. You should be prompted to change your password. Save the updated password in your password manager.</li>
</ol>
<h3 id="enable-multi-factor-authentication-for-your-user">Enable multi-factor authentication for your user<a class="headerlink" href="#enable-multi-factor-authentication-for-your-user" title="Permanent link">&para;</a></h3>
<ol>
<li>Ensure the Duo Mobile app is installed on your phone.</li>
<li>In the upper-left corner of the Snowsight UI, click on your username, and select "Profile"</li>
<li>At the bottom of the dialog, select "Enroll" to enable multi-factor authentication.</li>
<li>Follow the instructions to link the new account with your Duo app.</li>
</ol>
<h3 id="set-up-key-pair-authentication">Set up key pair authentication<a class="headerlink" href="#set-up-key-pair-authentication" title="Permanent link">&para;</a></h3>
<p>Certain Snowflake clients don't properly cache MFA tokens,
which means that using them can generate dozens or hundreds of MFA requests on your phone.
At best this makes the tools unusable, and at worst it can lock your Snowflake account.
One example of such a tool is (as of this writing) the Snowflake Terraform Provider.</p>
<p>The recommended workaround for this is to add a key pair to your account for use with those tools.</p>
<ol>
<li>Follow the instructions given <a href="https://docs.snowflake.com/en/user-guide/key-pair-auth#configuring-key-pair-authentication">here</a>
    to generate a key pair and add the public key to your account.
    Keep the key pair in a secure place on your device.
    <a href="https://gist.github.com/ian-r-rose/1c714ee04be53f7a3fd80322e1a22c27">This gist</a>
    contains the bash commands from the instructions,
    and can be helpful for quickly creating a new encrypted key pair.
    Usage of the script looks like:
    <div class="highlight"><pre><span></span><code>bash<span class="w"> </span>generate_encrypted_key.sh<span class="w"> </span>&lt;key-name&gt;<span class="w"> </span>&lt;passphrase&gt;
</code></pre></div>
    You can use <code>pbcopy &lt; _your_public_key_file_name_.pub</code> to copy the contents of your public key.
    Be sure to remove the <code>----BEGIN PUBLIC KEY----</code> and <code>-----END PUBLIC KEY------</code> portions
    when adding your key to your Snowflake user.</li>
<li>In your local <code>.bash_profile</code> or an <code>.env</code> file, add environment variables for
    <code>SNOWFLAKE_ACCOUNT</code>, <code>SNOWFLAKE_USER</code>, <code>SNOWFLAKE_PRIVATE_KEY_PATH</code>,
    and (if applicable) <code>SNOWFLAKE_PRIVATE_KEY_PASSPHRASE</code>.</li>
</ol>
<h3 id="apply-a-session-policy">Apply a session policy<a class="headerlink" href="#apply-a-session-policy" title="Permanent link">&para;</a></h3>
<p>By default, Snowflake logs out user sessions after four hours of inactivity.
ODI's information security policies prefer that we log out after one hour of inactivity for most accounts,
and after fifteen minutes of inactivity for particularly sensitive accounts.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It's possible we will do this using Terraform in the future,
but at the time of this writing the Snowflake Terraform provider does not support session policies.</p>
</div>
<p>After the Snowflake account is created, run the following script in a worksheet
to set the appropriate session policy:</p>
<div class="highlight"><pre><span></span><code><span class="n">use</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">sysadmin</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">policies</span><span class="p">;</span>
<span class="k">create</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">exists</span><span class="w"> </span><span class="n">policies</span><span class="p">.</span><span class="k">public</span><span class="p">.</span><span class="n">account_session_policy</span>
<span class="w">  </span><span class="n">session_idle_timeout_mins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span>
<span class="w">  </span><span class="n">session_ui_idle_timeout_mins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">60</span>
<span class="p">;</span>
<span class="n">use</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">accountadmin</span><span class="p">;</span>
<span class="c1">-- alter account unset session policy;  -- unset any previously existing session policy</span>
<span class="k">alter</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">session</span><span class="w"> </span><span class="n">policy</span><span class="w"> </span><span class="n">policies</span><span class="p">.</span><span class="k">public</span><span class="p">.</span><span class="n">account_session_policy</span><span class="p">;</span>
</code></pre></div>
<h3 id="developing-against-production-data">Developing against production data<a class="headerlink" href="#developing-against-production-data" title="Permanent link">&para;</a></h3>
<p>Our Snowflake architecture allows for reasonably safe <code>SELECT</code>ing from the production databases while developing models.
While this could be expensive for large tables, it also allows for faster and more reliable model development.</p>
<p>To develop against production data, first you need someone with the <code>USERADMIN</code> role to grant rights to the <code>TRANSFORMER_DEV</code> role (this need only be done once, and can be revoked later). These grants enable access to real data for development and facilitate cloning and deferral for large-table projects:</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">USERADMIN</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">RAW_PRD_READ</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">TRANSFORMER_DEV</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">TRANSFORM_PRD_READ</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">TRANSFORMER_DEV</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">ANALYTICS_PRD_READ</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">TRANSFORMER_DEV</span><span class="p">;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These grants are not managed via Terraform in order to keep the configurations of
different environments as logically separate as possible. We may revisit this
decision should the manual grants cause problems.</p>
</div>
<p>You can then run dbt locally and specify the <code>RAW</code> database manually:</p>
<div class="highlight"><pre><span></span><code><span class="nv">DBT_RAW_DB</span><span class="o">=</span>RAW_PRD<span class="w"> </span>dbt<span class="w"> </span>run
</code></pre></div>
<h3 id="streamlit-dashboard-development">Streamlit dashboard development<a class="headerlink" href="#streamlit-dashboard-development" title="Permanent link">&para;</a></h3>
<p>All production Streamlit dashboards and their marts should reside in the <code>ANALYTICS_{env}_PRD</code> database.
If a dashboard needs access to objects from earlier layers, they should be exposed via explicitly created mart tables in this database.</p>
<p>To support Streamlit development, the <code>REPORTER_DEV</code> role may need read access to the production marts:</p>
<div class="highlight"><pre><span></span><code><span class="n">USE</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">USERADMIN</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">ANALYTICS_PRD_READ</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">ROLE</span><span class="w"> </span><span class="n">REPORTER_DEV</span><span class="p">;</span>
</code></pre></div>
<h3 id="add-it-ops-representatives">Add IT-Ops representatives<a class="headerlink" href="#add-it-ops-representatives" title="Permanent link">&para;</a></h3>
<p>TODO: establish and document processes here.</p>
<h3 id="set-up-okta-sso-and-scim">Set up Okta SSO and SCIM<a class="headerlink" href="#set-up-okta-sso-and-scim" title="Permanent link">&para;</a></h3>
<p>TODO: establish and document processes here.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>