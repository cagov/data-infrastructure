version: 2

sources:
  - name: ga4
    overrides: ga4
    tables:
      - name: events
        freshness:
          warn_after:
            count: 3
            period: day
          error_after:
            count: 4
            period: day
        # Use magic metadata column of the sharded events table to check
        # the most recent date of data. This often winds up being ~2 days
        # behind the current timestamp UTC, since the GA4 data are in PST
        # but the date field gets normalized to UTC. Rather than jumping
        # through a bunch of time-zone hoops, just start raising flags after
        # three days.
        loaded_at_field: PARSE_TIMESTAMP("%Y%m%d", _TABLE_SUFFIX)
